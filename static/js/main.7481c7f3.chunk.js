(this["webpackJsonposiris-client"]=this["webpackJsonposiris-client"]||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(15),c=n.n(a),s=(n(40),n(11)),i=n(3),o=(n(41),n(17)),u=n(2),l=n.n(u),j=n(5),f=n(9),h=n(18),d="https://sgs-seatpicker.herokuapp.com",b=(n(10),n(14)),p=n.n(b),v=n(26),O=n.n(v);var x=function(e){var t=(e.search||"").replace("?","");return t?p.a.parse(t):{}},w=function(e){var t=function(e){var t=(e.anchor||"").split("?");return t.length>1?t[1]:null}(e);return t?p.a.parse(t):{}};function m(e){return O()({},w(e),x(e))}function g(){return window.open("".concat(d,"/api/auth/login"),"Osiris2 Authentication","scrollbars=no,toolbar=no,location=no,titlebar=no,directories=no,status=no,menubar=no")}function k(e,t,n){if(!t)return console.log("Setting up authentication"),new Promise((function(t,n){k(e,t,n)}));var r;try{r=m(e.location)}catch(a){}r&&r.jwt?(console.log("We did it reddit!"),e.close(),t(r.jwt)):e.closed?n({err:"Authentication cancelled."}):setTimeout((function(){k(e,t,n)}),0)}var y=n(1),_=Object(r.createContext)();function S(e){var t=Object(h.useState)(window.localStorage.getItem("jwt")),n=Object(f.a)(t,2),r=n[0],a=n[1],c=Object(h.useState)(null),s=Object(f.a)(c,2),i=s[0],u=s[1];function b(){return b=Object(j.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g(),e.next=3,k(t);case 3:n=e.sent,window.localStorage.setItem("jwt",n),a(n);case 6:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function p(){return(p=Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.localStorage.removeItem("jwt"),a(null);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(h.useEffect)((function(){Object(j.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=18;break}return e.prev=1,t=new Request("".concat(d,"/api/users/@me"),{headers:{Authorization:"Bearer ".concat(r)}}),e.next=5,fetch(t);case 5:return n=e.sent,e.next=8,n.json();case 8:c=e.sent,u(c),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),u(null),a(null);case 16:e.next=19;break;case 18:u(null);case 19:case"end":return e.stop()}}),e,null,[[1,12]])})))()}),[r]),Object(y.jsx)(_.Provider,Object(o.a)({value:{jwt:r,user:i,login:function(){return b.apply(this,arguments)},logout:function(){return p.apply(this,arguments)}}},e))}var I=function(){return Object(r.useContext)(_)};function N(){var e=I();if(e.user){var t=e.user;return Object(y.jsxs)("div",{className:"osirisAuthentication",children:[Object(y.jsx)("img",{src:t.profile_url,alt:t.tag,className:"osirisLoggedInUserImg"}),"You are logged in as ",t.tag,Object(y.jsx)("button",{onClick:e.logout,children:"Logout"})]})}return Object(y.jsx)("div",{className:"osirisAuthentication",children:Object(y.jsx)("button",{onClick:e.login,children:"Login"})})}function E(e){var t=Object(r.useState)([]),n=Object(f.a)(t,2),a=n[0],c=n[1];Object(r.useEffect)((function(){Object(j.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(d,"/api/events"));case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,c(n);case 7:case"end":return e.stop()}}),e)})))()}),[]);var i=a.map((function(e){return Object(y.jsx)("div",{className:"osirisEvent",children:Object(y.jsx)(s.b,{to:"/e/".concat(e.event_id),children:e.name})},e.event_id)}));return Object(y.jsx)("div",{className:"osirisEventSelect",children:i})}function A(){var e=Object(i.f)().eventId,t=Object(r.useState)([]),n=Object(f.a)(t,2),a=n[0],c=n[1];Object(r.useEffect)((function(){Object(j.a)(l.a.mark((function t(){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=8;break}return t.next=3,fetch("".concat(d,"/api/events/").concat(e));case 3:return n=t.sent,t.next=6,n.json();case 6:r=t.sent,c(r.layouts);case 8:case"end":return t.stop()}}),t)})))()}),[e]);var o=a.map((function(t){return Object(y.jsx)("div",{className:"osirisLayout",children:Object(y.jsx)(s.b,{to:"/e/".concat(e,"/l/").concat(t.layout_id),children:t.name})},t.layout_id)}));return Object(y.jsx)("div",{className:"osirisLayoutSelect",children:o})}var C=n(54),L=n(55),P=n(56),T=n(30),B=Object(r.createContext)();function z(e){return Object(y.jsx)(B.Provider,Object(o.a)({value:I().user},e))}var R=function(){return Object(r.useContext)(B)},U=n(29),W=new(n.n(U).a);function Y(){var e=Object(i.f)(),t=e.eventId,n=e.layoutId,a=Object(i.e)(),c=Object(r.useState)([]),s=Object(f.a)(c,2),o=s[0],u=s[1],h=Object(r.useState)(null),b=Object(f.a)(h,2),p=b[0],v=b[1],O=Object(T.a)(),x=O.width,w=O.height,m=O.ref,g=R(),k=Object(r.useCallback)(Object(j.a)(l.a.mark((function e(){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(d,"/api/events/").concat(t,"/layouts/").concat(n));case 2:return r=e.sent,e.next=5,r.json();case 5:a=e.sent,u(a);case 7:case"end":return e.stop()}}),e)}))),[t,n]);Object(r.useEffect)((function(){k()}),[t,n,k]),Object(r.useEffect)((function(){var e=W.add(k);return function(){W.detach(e)}}));var _=Object(C.a)(o,(function(e){return e.x_pos})),S=Object(L.a)(o,(function(e){return e.x_pos})),I=Object(C.a)(o,(function(e){return e.y_pos})),N=Object(L.a)(o,(function(e){return e.y_pos})),E=Object(P.a)().domain([_,S]).range([20,x-20]),A=Object(P.a)().domain([I,N]).range([20,w-20]),B=o.map((function(e){return Object(y.jsx)("circle",{cx:E(e.x_pos),cy:A(e.y_pos),r:10,fill:"black",className:(e.user_id?g&&e.user_id===g.user_id?"mine":"picked":"unpicked")+(e.seat_id===p?" selected":""),onClick:function(){return r=e.seat_id,a.push("/e/".concat(t,"/l/").concat(n,"/s/").concat(r)),void v(r);var r}},e.seat_id)}));return Object(y.jsx)("div",{className:"osirisLayoutView",ref:m,children:Object(y.jsx)("svg",{children:B})})}var q=n(33),J=n(34),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{jwt:void 0},n=t.jwt;Object(q.a)(this,e),this.jwt=n}return Object(J.a)(e,[{key:"getSeat",value:function(){var e=Object(j.a)(l.a.mark((function e(t,n){var r,a,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(d,"/api/events/").concat(t,"/seat/").concat(n));case 2:return r=e.sent,e.next=5,r.json();case 5:if(!(a=e.sent).user_id){e.next=14;break}return e.next=9,fetch("".concat(d,"/api/users/").concat(a.user_id));case 9:return c=e.sent,e.next=12,c.json();case 12:s=e.sent,a.user=s;case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reserveSeat",value:function(){var e=Object(j.a)(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkAuthentication(),e.next=3,fetch("".concat(d,"/api/events/").concat(t,"/seat/").concat(n),{method:"PUT",headers:{Authorization:"Bearer ".concat(this.jwt)}});case 3:return r=e.sent,e.next=6,r.json();case 6:if(a=e.sent,console.log(a),"err"!==a.status){e.next=19;break}e.t0=a.err,e.next="user_has_existing_reservation"===e.t0?12:14;break;case 12:return alert("You already hold a reservation for this event. You must clear that reservation prior to reserving a new seat."),e.abrupt("break",16);case 14:return alert("An error occurred while setting your reservation."),e.abrupt("break",16);case 16:return e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"releaseSeat",value:function(){var e=Object(j.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkAuthentication(),e.next=3,fetch("".concat(d,"/api/events/").concat(t,"/seat/").concat(n),{method:"DELETE",headers:{Authorization:"Bearer ".concat(this.jwt)}});case 3:return r=e.sent,e.abrupt("return",r.ok);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_checkAuthentication",value:function(){if(!this.jwt)throw new Error("This method required authentication.")}}]),e}();function D(){var e,t=Object(i.f)(),n=t.eventId,a=t.seatId,c=Object(r.useState)({tag:"Unknown",user:void 0}),s=Object(f.a)(c,2),o=s[0],u=s[1],h=R(),d=Object(r.useCallback)(Object(j.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new V({}),e.next=3,t.getSeat(n,a);case 3:r=e.sent,u(r);case 5:case"end":return e.stop()}}),e)}))),[n,a]);return Object(r.useEffect)((function(){d()}),[n,a,d]),e=o.user?h&&o.user.user_id===h.user_id?Object(y.jsx)($,{seat:o,refreshSeat:d}):Object(y.jsx)(F,{seat:o}):Object(y.jsx)(G,{seat:o,refreshSeat:d}),Object(y.jsxs)("div",{className:"osirisSeatView",children:[Object(y.jsxs)("h1",{children:["Seat ",o.tag]}),e]})}function G(e){var t=e.seat,n=e.refreshSeat,r=t.seat_id,a=Object(i.f)().eventId,c=I(),s=c.jwt&&c.user;function o(){return(o=Object(j.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new V(c),e.next=3,t.reserveSeat(a,r);case 3:e.sent&&(n(),W.dispatch());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(y.jsxs)("div",{children:[Object(y.jsx)("p",{children:"This seat is available. It could be yours!"}),Object(y.jsx)("button",{onClick:function(){return o.apply(this,arguments)},disabled:!s,children:"Reserve"})]})}function $(e){var t=e.seat,n=e.refreshSeat,r=t.seat_id,a=Object(i.f)().eventId,c=I();function s(){return(s=Object(j.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new V(c),e.next=3,t.releaseSeat(a,r);case 3:e.sent&&(n(),W.dispatch());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(y.jsxs)("div",{children:[Object(y.jsx)("img",{src:t.user.profile_url,alt:t.user.tag,className:"osirisProfileImg"}),Object(y.jsx)("p",{children:"This is your seat!"}),Object(y.jsx)("button",{onClick:function(){return s.apply(this,arguments)},children:"Release"})]})}function F(e){var t=e.seat;return Object(y.jsxs)("div",{children:[Object(y.jsx)("img",{src:t.user.profile_url,alt:t.user.tag,className:"osirisProfileImg"}),Object(y.jsxs)("p",{children:["This seat has been picked by ",t.user.tag]})]})}function H(){return Object(y.jsx)(s.a,{children:Object(y.jsxs)("div",{className:"root",children:[Object(y.jsxs)("div",{className:"osirisBar",children:[Object(y.jsx)("h1",{children:"SGS Seat Picker"}),Object(y.jsx)(N,{})]}),Object(y.jsxs)("div",{className:"osirisApp",children:[Object(y.jsx)(i.a,{path:"/",component:E}),Object(y.jsx)(i.a,{path:"/e/:eventId",component:A}),Object(y.jsx)(i.a,{path:"/e/:eventId/l/:layoutId",component:Y}),Object(y.jsx)(i.a,{path:"/e/:eventId/l/:layoutId/s/:seatId",component:D})]})]})})}function K(e){var t=e.children;return Object(y.jsx)(S,{children:Object(y.jsx)(z,{children:t})})}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(y.jsx)(K,{children:Object(y.jsx)(H,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[50,1,2]]]);
//# sourceMappingURL=main.7481c7f3.chunk.js.map